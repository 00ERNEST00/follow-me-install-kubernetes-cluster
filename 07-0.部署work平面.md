tags: node, flanneld, docker, kubeconfig, kubelet, kube-proxy

# 部署 work 平面

kubernetes  work 平面包含如下组件：

+ docker
+ kubelet
+ kube-proxy

## 使用的变量

本文档用到的变量定义如下：

``` bash
$ # 替换为 kubernetes master 集群任一机器 IP
$ export MASTER_IP=172.27.129.80
$ export KUBE_APISERVER="https://${MASTER_IP}:6443"
$ # 当前部署的节点 IP
$ export NODE_IP=172.27.129.80
$ # 当前不熟的节点名称，须符合： [a-z0-9:-]{0,255}[a-z0-9]
$ export NODE_NAME=kube-node1
$ # 导入用到的其它全局变量：ETCD_ENDPOINTS、FLANNEL_ETCD_PREFIX、CLUSTER_CIDR、CLUSTER_DNS_SVC_IP、CLUSTER_DNS_DOMAIN、SERVICE_CIDR
$ source /opt/k8s/bin/environment.sh
$
```

## 安装和配置 flanneld

参考 [05-部署Flannel网络.md](./05-部署Flannel网络.md)

## 安装依赖包

``` bash
[k8s@kube-node1 k8s]$ for node_ip in ${NODE_IPS[@]}
  do
    ssh root@${node_ip} "yum install -y conntrack ipvsadm ipset jq && /usr/sbin/modprobe ip_vs "
  done
```